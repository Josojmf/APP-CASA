{% extends "layout.html" %}
{% block title %}ðŸ’¬ Asistente Familiar{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/ai.css') }}">
{% endblock %}

{% block content %}
<div class="chat-container">
    <h2 class="titleChat">ðŸ¤– Asistente Familiar</h2>
    <div id="ai-messages" class="messages"></div>

    <div id="chat-input">
        <input id="ai-input" type="text" placeholder="Escribe tu mensaje..." onkeydown="if(event.key==='Enter') askAI()" />
        <button onclick="askAI()">âž¤</button>
    </div>
</div>

<script>
    async function askAI() {
        const input = document.getElementById("ai-input");
        const prompt = input.value.trim();
        if (!prompt) return;

        appendMessage("sent", "TÃº", prompt);
        input.value = "";

        try {
            const res = await fetch("/api/chatfd", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ prompt })
            });
            const data = await res.json();
            const reply = data.answer || data.error || "Sin respuesta";
            appendMessage("received", "IA", reply);
        } catch {
            appendMessage("received", "IA", "Error al conectar con el servidor.");
        }
    }

    function appendMessage(type, sender, text) {
        const msgDiv = document.createElement("div");
        msgDiv.className = `message ${type}`;
        msgDiv.innerHTML = `
            <img src="${type === 'sent' ? '/static/img/user.png' : '/static/img/ai.png'}" alt="${sender}">
            <div class="message-content">
                <strong>${sender}</strong>
                <span>${text}</span>
            </div>
        `;
        document.getElementById("ai-messages").appendChild(msgDiv);
        msgDiv.scrollIntoView({ behavior: "smooth" });
    }
</script>
{% endblock %}
