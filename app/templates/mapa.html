{% extends "layout.html" %}
{% block title %}📍 Mapa en tiempo real{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
<style>
  #map { height: 80vh; width: 100%; margin-top: 20px; border-radius: 12px; }
</style>
{% endblock %}

{% block content %}
<h1 class="title">📍 Mapa de ubicaciones</h1>
<div id="map"></div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script>
  const posiciones = {{ posiciones | tojson }};
  const map = L.map('map').setView([40.4168, -3.7038], 6);  // España centro

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
  }).addTo(map);

  posiciones.forEach(pos => {
    if (pos.lat && pos.lon) {
      const marker = L.marker([pos.lat, pos.lon]).addTo(map);
      marker.bindPopup(`<strong>${pos.user || 'Usuario'}</strong><br>${pos.time || ''}`);
    }
  });
</script>
{% endblock %}
